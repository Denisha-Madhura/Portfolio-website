---
type NavItem = {
  name: string;
  href: string;
  external?: boolean;
  isButton?: boolean;
};

const navItems: NavItem[] = [
  { name: "Home", href: "/" },
  { name: "About", href: "/about" },
  { name: "Projects", href: "/projects" },
  { name: "Experience", href: "/experience" },
  { name: "Resume", href: "/resume" },
];

import { Image } from "astro:assets";
// Placeholder for DM logo or just text
---

<nav
  id="navbar"
  class="fixed top-0 left-0 w-full z-50 px-6 py-4 flex justify-between items-center transition-all duration-300"
>
  <div
    id="nav-bg"
    class="absolute inset-0 bg-transparent backdrop-blur-none border-b border-transparent transition-all duration-500"
  >
  </div>

  {/* DM Logo / Hero Element */}
  <a
    href="/"
    class="relative z-10 group"
    onclick="event.preventDefault(); window.dispatchEvent(new CustomEvent('trigger-genie'));"
  >
    <div
      class="w-12 h-12 rounded-full border border-white/10 bg-white/5 flex items-center justify-center overflow-hidden"
    >
      <span class="font-bold text-lg text-white/50 relative z-20">DM</span>
    </div>

    {/* Click Tooltip */}
    <div
      class="absolute -bottom-8 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap"
    >
      <span class="text-[10px] uppercase tracking-widest text-white/60"
        >Click Here</span
      >
    </div>
  </a>

  {/* Desktop Navigation Links */}
  <div class="relative z-10 hidden md:flex gap-8">
    {
      navItems.map((item) => (
        <a
          href={item.href}
          target={item.external ? "_blank" : "_self"}
          rel={item.external ? "noopener noreferrer" : ""}
          class="relative text-sm font-medium text-white/50 hover:text-white transition-colors duration-300 group"
        >
          {item.name}
          {/* Underglow Effect */}
          <span class="absolute -bottom-2 left-1/2 -translate-x-1/2 w-0 h-[2px] bg-white shadow-[0_0_10px_rgba(255,255,255,0.8)] rounded-full transition-all duration-300 group-hover:w-full opacity-0 group-hover:opacity-100" />
        </a>
      ))
    }
  </div>

  {/* Mobile Menu Toggle */}
  <button
    id="mobile-toggle"
    class="relative z-50 md:hidden w-10 h-10 flex items-center justify-center rounded-full border border-white/10 bg-white/5 text-white transition-all duration-300 hover:bg-white/10"
    aria-label="Toggle Menu"
  >
    <div class="relative w-5 h-4 flex flex-col justify-between overflow-hidden">
      <span
        id="line-1"
        class="w-full h-0.5 bg-current transform transition-all duration-300 origin-left"
      ></span>
      <span
        id="line-2"
        class="w-full h-0.5 bg-current transform transition-all duration-300"
      ></span>
      <span
        id="line-3"
        class="w-full h-0.5 bg-current transform transition-all duration-300 origin-left"
      ></span>
    </div>
  </button>

  {/* Mobile Menu Overlay */}
  <div
    id="mobile-menu"
    class="fixed inset-0 z-40 bg-black/95 backdrop-blur-xl flex flex-col items-center justify-center opacity-0 pointer-events-none transition-all duration-500"
  >
    <div class="flex flex-col gap-8 text-center">
      {
        navItems.map((item, index) => (
          <a
            href={item.href}
            target={item.external ? "_blank" : "_self"}
            rel={item.external ? "noopener noreferrer" : ""}
            class="mobile-link text-2xl font-light text-white/50 hover:text-white transition-all duration-500 translate-y-8 opacity-0"
            style={`transition-delay: ${index * 50}ms`}
          >
            {item.name}
          </a>
        ))
      }
    </div>
  </div>
</nav>

<script>
  function initNavbar() {
    const navBg = document.getElementById("nav-bg");
    const mobileToggle = document.getElementById("mobile-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const line1 = document.getElementById("line-1");
    const line2 = document.getElementById("line-2");
    const line3 = document.getElementById("line-3");
    const mobileLinks = document.querySelectorAll(".mobile-link");
    let isMenuOpen = false;

    function toggleMenu() {
      isMenuOpen = !isMenuOpen;

      if (isMenuOpen) {
        // Open Menu
        mobileMenu.classList.remove("opacity-0", "pointer-events-none");
        mobileMenu.classList.add("opacity-100", "pointer-events-auto");

        // Animate Hamburger to X
        line1.classList.add("rotate-45", "translate-x-px", "-translate-y-px");
        line2.classList.add("opacity-0", "translate-x-full");
        line3.classList.add("-rotate-45", "translate-x-px", "translate-y-px");

        // Stagger in links
        mobileLinks.forEach((link) => {
          link.classList.remove("translate-y-8", "opacity-0");
        });

        // Lock scroll
        document.body.style.overflow = "hidden";
      } else {
        // Close Menu
        mobileMenu.classList.add("opacity-0", "pointer-events-none");
        mobileMenu.classList.remove("opacity-100", "pointer-events-auto");

        // Animate X to Hamburger
        line1.classList.remove(
          "rotate-45",
          "translate-x-px",
          "-translate-y-px",
        );
        line2.classList.remove("opacity-0", "translate-x-full");
        line3.classList.remove(
          "-rotate-45",
          "translate-x-px",
          "translate-y-px",
        );

        // Reset links
        mobileLinks.forEach((link) => {
          link.classList.add("translate-y-8", "opacity-0");
        });

        // Unlock scroll
        document.body.style.overflow = "";
      }
    }

    if (mobileToggle) {
      // Clone and replace to prevent duplicate listeners on View Transitions
      const newToggle = mobileToggle.cloneNode(true);
      mobileToggle.parentNode.replaceChild(newToggle, mobileToggle);
      newToggle.addEventListener("click", toggleMenu);
    }

    // Close menu when clicking a link
    mobileLinks.forEach((link) => {
      link.addEventListener("click", () => {
        if (isMenuOpen) toggleMenu();
      });
    });

    // Initial check
    if (navBg) {
      if (window.scrollY > 50) {
        navBg.classList.remove(
          "bg-transparent",
          "backdrop-blur-none",
          "border-transparent",
        );
        navBg.classList.add(
          "bg-black/20",
          "backdrop-blur-md",
          "border-white/5",
        );
      } else {
        navBg.classList.add(
          "bg-transparent",
          "backdrop-blur-none",
          "border-transparent",
        );
        navBg.classList.remove(
          "bg-black/20",
          "backdrop-blur-md",
          "border-white/5",
        );
      }
    }

    const onScroll = () => {
      if (navBg) {
        if (window.scrollY > 50) {
          navBg.classList.remove(
            "bg-transparent",
            "backdrop-blur-none",
            "border-transparent",
          );
          navBg.classList.add(
            "bg-black/20",
            "backdrop-blur-md",
            "border-white/5",
          );
        } else {
          navBg.classList.add(
            "bg-transparent",
            "backdrop-blur-none",
            "border-transparent",
          );
          navBg.classList.remove(
            "bg-black/20",
            "backdrop-blur-md",
            "border-white/5",
          );
        }
      }
    };

    window.addEventListener("scroll", onScroll);

    // Clean up listener when navigating away to prevent memory leaks or duplicates if re-running
    document.addEventListener(
      "astro:before-preparation",
      () => {
        window.removeEventListener("scroll", onScroll);
      },
      { once: true },
    );
  }

  // Run on initial load
  initNavbar();

  // Run on view transitions navigation
  document.addEventListener("astro:page-load", initNavbar);
</script>
